import{r as e,j as t}from"./react-o30OhbXm.js";import{P as s}from"./prop-types-6BVzj02S.js";import{h as r}from"./moment-Dbf0ZKEX.js";import{A as o}from"./index-Fhzl4wd3.js";import{L as a}from"./react-router-E73Z85nW.js";import{H as n,l as i,y as l,P as c,E as d,L as u,q as m,z as p}from"./@headlessui-C7--rYu4.js";import{H as h}from"./@hcaptcha-BrXksSiK.js";import{F as f}from"./@heroicons-CIKUpSda.js";import{a as x}from"./axios-ClDWm0N0.js";import"./cookie-DpVX6GIM.js";import"./react-dom-D0FUoFqf.js";import"./scheduler-CebB03oh.js";import"./framer-motion-F5GiQeRV.js";import"./motion-dom-DcoJg7IW.js";import"./motion-utils-CzqutjiG.js";import"./@react-aria-BTO1FRNT.js";import"./@react-stately-PD2_Sufv.js";import"./use-sync-external-store-DtRQimMC.js";import"./@floating-ui--AanpjYa.js";import"./@babel-Df3wz5eM.js";const g=e.createContext(null);function b({children:s}){const[r,o]=e.useState(""),[a,n]=e.useState(""),[i,l]=e.useState(null),[c,d]=e.useState(!0),[u,m]=e.useState(null),p={vUpdateTime:r,setVUpdateTime:o,latestRegister:a,setLatestRegister:n,postsPending:i,setPostsPending:l,isLoading:c,setIsLoading:d,error:u,setError:m};return t.jsx(g.Provider,{value:{...p},children:s})}function j({children:e}){return t.jsx("span",{className:"arial",children:e})}function v({time:s}){function o(e){const t=new Date(e),s=new Intl.DateTimeFormat("en-CA",{timeZone:"America/Sao_Paulo",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(t),r=e=>{var t;return null==(t=s.find((t=>t.type===e)))?void 0:t.value};return`${r("year")}-${r("month")}-${r("day")}T${r("hour")}:${r("minute")}:${r("second")}`}const a=r(o(new Date(s))),[n,i]=e.useState("pouco"),l=e.useCallback((()=>{const e=r(o(new Date)),t=e.diff(a,"seconds");let s=e.diff(a,"minutes"),n=e.diff(a,"hours");n="localhost"===window.location.hostname?n:n-3,s="localhost"!==window.location.hostname&&s>=180?s-180:s,n="localhost"!==window.location.hostname&&s>=60&&n<4?Math.floor(s/60):n,i(n>0?`${n} ${n>1?"horas":"hora"}`:s>0?`${s} ${s>1?"minutos":"minuto"}`:t>0?`${t} ${t>1?"segundos":"segundo"}`:"pouco")}),[a]);return e.useEffect((()=>{l();const e=setInterval(l,1e3);return()=>clearInterval(e)}),[l]),t.jsx(t.Fragment,{children:n})}function w({children:e}){return t.jsx("div",{className:"group grid max-w-sm h-[100%] gap-6 md:mx-auto lg:mx-auto lg:max-w-none lg:grid-cols-4",children:e})}function y({children:s,className:r=""}){const o=e.useRef(null),a=function(){const[t,s]=e.useState({x:0,y:0});return e.useEffect((()=>{const e=e=>{s({x:e.clientX,y:e.clientY})};return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[]),t}(),n=e.useRef({x:0,y:0}),i=e.useRef({w:0,h:0}),[l,c]=e.useState([]);e.useEffect((()=>{o.current&&c(Array.from(o.current.children).map((e=>e)))}),[]),e.useEffect((()=>(d(),window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d)})),[l]),e.useEffect((()=>{u()}),[a]);const d=()=>{o.current&&(i.current.w=o.current.offsetWidth,i.current.h=o.current.offsetHeight)},u=()=>{if(o.current){const e=o.current.getBoundingClientRect(),{w:t,h:s}=i.current,r=a.x-e.left,c=a.y-e.top;r<t&&r>0&&c<s&&c>0&&(n.current.x=r,n.current.y=c,l.forEach((t=>{const s=-(t.getBoundingClientRect().left-e.left)+n.current.x,r=-(t.getBoundingClientRect().top-e.top)+n.current.y;t.style.setProperty("--mouse-x",`${s}px`),t.style.setProperty("--mouse-y",`${r}px`)})))}};return t.jsx("div",{className:r,ref:o,children:s})}b.propTypes={children:s.node},j.propTypes={children:s.node},v.propTypes={time:s.string.isRequired},w.propTypes={children:s.node};const N="eskimozin",k="localhost"===window.location.hostname?"http://localhost:8001":"https://gabriers.up.railway.app",C="localhost"===window.location.hostname?"http://localhost:8010":"",P="https://github.com/eskimozin/reddit-mod-queue/issues/new",T="https://reddit.com/r/eskimozin",L={rel:"noopener noreferrer",target:"_blank",className:"focus-headless focus:text-white hover:text-white transition-colors"};function A({title:e,img:s,subtitle:r,description:o,action:i=()=>{},btnLabel:l="Abrir no Reddit",link:c=T}){let d=t.jsx(y,{children:t.jsxs("div",{className:"relative overflow-hidden before:pointer-events-none before:absolute before:-left-40 before:-top-40 before:z-10 before:h-80 before:w-80 before:translate-x-[var(--mouse-x)] before:translate-y-[var(--mouse-y)] before:rounded-full before:border-slate-500 before:opacity-0 before:blur-3xl before:transition-opacity before:duration-500 after:pointer-events-none after:absolute after:-left-48 after:-top-48 after:z-30 after:h-64 after:w-64 after:translate-x-[var(--mouse-x)] after:translate-y-[var(--mouse-y)] after:rounded-full after:bg-slate-600 after:opacity-0 after:blur-3xl after:transition-opacity after:duration-500 after:hover:opacity-20 before:group-hover:opacity-100 bg-blackrounded-md text-white border border-white/10 bg-white/5 rounded-lg",children:[s?t.jsx("div",{className:"relative z-15",children:t.jsx("img",{src:s,className:"object-cover w-full h-[200px]",alt:e})}):"",t.jsxs("div",{className:"relative z-20 p-4 pt-5",children:[t.jsx("h2",{className:"block font-semibold text-xl line-clamp-2 text-ellipsis",children:e||"Título não retornado"}),t.jsx("p",{className:"text-gray-400 font-semibold mt-1 mb-0 line-clamp-2 text-ellipsis",children:r||"Usuário do post não retornado"}),t.jsx("p",{className:"mt-3 mb-4 pb-1",children:o}),t.jsxs(n,{className:"inline-flex items-center gap-1 rounded-[5px] bg-orange-600 border-orange-700 focus:bg-orange-700 hover:bg-orange-700 px-3 py-2 text-white/95  focus:not-data-focus:outline-none data-focus:outline data-focus:outline-white data-hover:bg-gray-600 data-open:bg-gray-700 focus-headless mb-1 transition-colors",onClick:e=>{e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),i&&i()},children:[l,t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"16px",viewBox:"0 -960 960 960",width:"16px",fill:"#FFF",children:t.jsx("path",{d:"M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h560v-280h80v280q0 33-23.5 56.5T760-120H200Zm188-212-56-56 372-372H560v-80h280v280h-80v-144L388-332Z"})})]})]})]})});return c?t.jsx(a,{to:c,...L,children:t.jsx(t.Fragment,{children:d})}):d}function S({children:e}){return t.jsx("div",{className:"bg-slate-800 border border-white/10 rounded-md p-3 mt-5 text-slate-400 items-center gap-2 inline-flex",children:e})}A.propTypes={title:s.string,subtitle:s.string,img:s.string,description:s.string,action:s.func,btnLabel:s.string},S.propTypes={children:s.node};const E=()=>{const[s,r]=e.useState(Array(6).fill("")),o=e.useRef([]),a=e=>{var t;const s=e.clipboardData.getData("text").toUpperCase();if(!/^[A-Z0-9]{6}$/.test(s))return;const a=s.split("");r(a),a.forEach(((e,t)=>{o.current[t]&&(o.current[t].value=e)})),null==(t=o.current[5])||t.focus()};return t.jsx("div",{className:"flex gap-1 justify-center mt-4 w-full",children:s.map(((e,n)=>t.jsx("input",{type:"text",maxLength:1,value:e,ref:e=>{o.current[n]=e},onChange:e=>((e,t)=>{var a;if(!/^[a-zA-Z0-9]?$/.test(e))return;const n=[...s];n[t]=e.toUpperCase(),r(n),e&&t<5&&(null==(a=o.current[t+1])||a.focus())})(e.target.value,n),onKeyDown:e=>{return r=n,"Backspace"===(t=e).key&&!s[r]&&r>0&&(null==(a=o.current[r-1])||a.focus()),"ArrowLeft"===t.key&&r>0&&(null==(i=o.current[r-1])||i.focus()),void("ArrowRight"===t.key&&r<5&&(null==(l=o.current[r+1])||l.focus()));var t,r,a,i,l},onPaste:a,placeholder:"0",className:"w-12 h-14 text-center focus-headless font-mono border rounded border-white/20 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-950/50 placeholder:text-white/25",required:!0},n)))})};function $(){let[s,r]=e.useState(!0);const a=e.useRef(null),[x,g]=e.useState(null),[b,j]=e.useState(""),[v,w]=e.useState("");return t.jsxs("div",{children:[t.jsxs(i,{children:[t.jsxs(l,{className:"mt-8 inline-flex items-center focus-headless gap-2 rounded bg-gray-800 px-3 py-2  text-white  focus:not-data-focus:outline-none data-focus:outline data-focus:outline-white data-hover:bg-gray-700 data-open:bg-gray-700",children:["Moderar todos de uma vez",t.jsx(f,{className:"size-4 fill-white/60"})]}),t.jsx(c,{transition:!0,anchor:"bottom end",className:"w-52 mt-1 origin-top-right rounded border border-white/20 bg-slate-900 p-1 text-white transition duration-100 ease-out [--anchor-gap:--spacing(1)] focus:outline-none data-closed:scale-95 data-closed:opacity-0",children:[["Aprovar",()=>{}],["Reprovar",()=>{}]].map(((e,s)=>t.jsx(d,{onClick:t=>{r(!0),w(e[0])},children:t.jsx("button",{className:"focus-headless group flex w-full items-center gap-2 rounded px-3 py-1.5 hover:bg-white/10 data-focus:bg-white/10 focus:bg-white/10",children:e[0]})},s)))})]}),t.jsx(u,{open:s,as:"div",className:"relative z-30 focus:outline-none",onClick:e=>e.preventDefault(),onClose:close,children:t.jsx("div",{className:"fixed inset-0 z-10 w-screen overflow-y-auto bg-black/70 backdrop-blur-md",onClick:e=>e.preventDefault(),children:t.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:t.jsxs(m,{onClick:e=>e.preventDefault(),transition:!0,className:"w-full max-w-md rounded-xl bg-white/10 p-6 backdrop-blur-2xl duration-300 ease-out data-closed:transform-[scale(95%)] data-closed:opacity-0",children:[t.jsxs(p,{as:"h3",className:"font-semibold text-[1.55rem]",children:["Confirmar ",["aprovar","reprovar"].includes(v.toLowerCase())?"aprovar"===v.toLowerCase()?"aprovação dos posts":"reprovação dos posts":"ação"]}),t.jsx("p",{className:"mt-2 text-white/70",children:"Enviamos um código para o canal de logs do servidor no Discord. Informe abaixo e confirme. Se o código expirar, reinicie a solicitação."}),t.jsxs("form",{action:"#",method:"POST",onSubmit:async e=>{if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),x)try{const e=await fetch(`${C}/api/verify-captcha`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:x})});(await e.json()).success||(j("Falha na validação do captcha, tente novamente."),a.current.resetCaptcha(),g(null))}catch(t){j("Erro ao validar captcha.")}else j("Por favor, complete o captcha antes de enviar.")},children:[t.jsx(E,{}),t.jsx("div",{className:"mt-5 flex items-center justify-center",children:t.jsx(h,{sitekey:"e730ec6c-0428-47b4-8964-7d56667e76dc",onVerify:e=>{g(e)},ref:a})}),b&&t.jsx(o,{children:t.jsx("div",{className:"flex flex-wrap gap-2 items-center text-center p-3 bg-orange-500/5 border border-orange-300/25 text-orange-300 mt-4 rounded",children:t.jsx("p",{className:"text-balance",children:b})})}),t.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 items-center justify-center",children:[t.jsx(n,{className:"inline-flex items-center gap-2 rounded-md bg-gray-700 px-3 py-1.5 text-white focus:not-data-focus:outline-none data-focus:outline data-focus:outline-white data-hover:bg-gray-600 data-open:bg-gray-700 focus-headless",onClick:e=>{e.stopPropagation(),r(!1)},children:"Cancelar"}),t.jsx(n,{type:"submit",className:"inline-flex items-center gap-2 rounded-md bg-orange-600 px-3 py-1.5 text-white focus:not-data-focus:outline-none data-focus:outline data-focus:outline-white data-hover:bg-gray-600 data-open:bg-gray-700 focus-headless",children:"Confirmar"})]})]})]})})})})]})}const z=()=>{const{vUpdateTime:s,latestRegister:r}=e.useContext(g);return t.jsxs("hgroup",{className:"flex items-center gap-4 mb-8 flex-wrap",children:[t.jsx("img",{src:"https://styles.redditmedia.com/t5_djonfq/styles/communityIcon_so6opouwbkwe1.jpeg?format=pjpg&s=87d36ec6c490962999a51fdc8b64bf180892131a",alt:"Foto de perfil do r/eskimozin",className:"rounded-full w-[50px] h-[50px] object-cover"}),t.jsxs("div",{className:"block",children:[t.jsxs("h1",{className:"text-balance font-bold text-3xl",children:["Fila de moderação do ",t.jsxs("span",{className:"text-orange-600",children:["r",t.jsx(j,{children:"/"}),N]})]}),t.jsxs("p",{className:"mb-0 mt-1 text-gray-400 text-balance max-w-[600px]",children:["Atualizado há ",s?t.jsx(v,{time:s}):"pouco",". O último post entrou na fila de moderação há ",r?t.jsx(v,{time:r}):"pouco",". A verificação da fila de moderação é feita a cada 5 minutos."]})]})]})},F=()=>{const{isLoading:s,postsPending:r,error:a}=e.useContext(g);return t.jsx(w,{children:t.jsx(o,{children:s&&!r?t.jsx(A,{title:"Carregando...",subtitle:"Conectando à API, aguarde",description:"Geralmente isso é rápido mas pode ser que demore um pouco.",link:T,btnLabel:"Ir pro subreddit"}):r?r.map(((t,s)=>{const r={title:t.post_title,subtitle:t.post_author_name,description:"",img:t.post_img_url,link:t.reddit_link,action:()=>{window.open(t.reddit_link,"_blank","noreferrer noopener")}};return e.createElement(A,{...r,key:s})})):a?t.jsx(A,{title:"Ocorreu um erro: "+a,subtitle:"Algo não saiu como deveria...",description:"",link:P,btnLabel:"Reportar"}):t.jsx(A,{title:"Não há nada por aqui...",subtitle:"Tudo certo!",description:"Sem posts para a moderação avaliar. Pegue uma bebida e aguarde.",btnLabel:"Ir pro subreddit"})})})},D=()=>{const{postsPending:s}=e.useContext(g);return t.jsx(t.Fragment,{children:s&&s.length>1&&t.jsx($,{})})},R=()=>{const{postsPending:s}=e.useContext(g);return t.jsxs(t.Fragment,{children:[s&&s.length>=10&&t.jsx(o,{children:t.jsxs(S,{children:[t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#94A3B8",className:"bi bi-exclamation-circle",viewBox:"0 0 16 16",children:[t.jsx("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"}),t.jsx("path",{d:"M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"})]}),t.jsx("span",{children:"Listamos apenas os 10 últimos posts pendentes de moderação."})]})}),t.jsx(S,{children:t.jsxs("div",{className:"flex gap-1 items-center",children:[t.jsx("p",{children:"Encontrou um erro?"})," ",t.jsx("a",{href:P,...L,children:t.jsxs("div",{className:"flex gap-1 items-center",children:[t.jsx("span",{className:"text-white",children:"Avisa pra gente!"}),t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"16px",viewBox:"0 -960 960 960",width:"16px",fill:"#FFF",children:t.jsx("path",{d:"M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h560v-280h80v280q0 33-23.5 56.5T760-120H200Zm188-212-56-56 372-372H560v-80h280v280h-80v-144L388-332Z"})})]})})]})})]})};function I(){const{setVUpdateTime:t,setLatestRegister:s,setPostsPending:o,setIsLoading:a,setError:n}=e.useContext(g);return e.useEffect((()=>{try{x.post(`${k}/api/get-latest-register/`).then((e=>{const{data:o}=e;if(o&&o.rows[0][0].datetime_register){const e=o.rows[0][0].datetime_register;s(e)}t(r().format("YYYY-MM-DDTHH:mm:ssZ"))}))}catch(e){alert("Um erro ocorreu! "+e.message)}}),[s,t]),e.useEffect((()=>{try{x.post(`${k}/api/get-unmoderates-posts/`).then((e=>{const{data:s}=e;s&&s.rows[0].length>0&&o(s.rows[0]),t(r().format("YYYY-MM-DDTHH:mm:ssZ"))})).catch((e=>{n(e.message)})).finally((()=>{a(!1)}))}catch(e){}}),[n,a,o,t]),null}function H(){const e={fontWeight:300,fontFamily:'"Inter Tight", "Inter", sans-serif',letterSpacing:.2};return t.jsx("div",{className:"container text-center pt-8 lg:pt-10 mt-8 lg:mt-10 border-t border-slate-800",children:t.jsxs("div",{className:"text-gray-400",children:[t.jsxs("div",{className:"flex items-center justify-center gap-1 text-decoration-none fw-light",style:{...e,color:"inherit"},children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-c-circle",viewBox:"0 0 16 16",children:t.jsx("path",{d:"M1 8a7 7 0 1 0 14 0A7 7 0 0 0 1 8m15 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8.146 4.992c-1.212 0-1.927.92-1.927 2.502v1.06c0 1.571.703 2.462 1.927 2.462.979 0 1.641-.586 1.729-1.418h1.295v.093c-.1 1.448-1.354 2.467-3.03 2.467-2.091 0-3.269-1.336-3.269-3.603V7.482c0-2.261 1.201-3.638 3.27-3.638 1.681 0 2.935 1.054 3.029 2.572v.088H9.875c-.088-.879-.768-1.512-1.729-1.512"})}),t.jsxs("span",{children:[r().utc().format("YYYY")," - "]}),t.jsxs("span",{children:["Fila de moderação do r",t.jsx(j,{children:"/"}),N]})]}),t.jsxs("a",{href:"https://github.com/gabriersdev",className:"text-decoration-none fw-light focus-headless",style:{...e,color:"inherit"},children:["Feito com 💖 pelo ","Gabriel","."]})]})})}function _(){return t.jsxs(b,{children:[t.jsx(I,{}),t.jsx("div",{className:"flex align-center justify-center",children:t.jsxs("div",{className:"container mx-3 my-8 lg:my-10 min-h-[90vh] flex justify-between flex-col",children:[t.jsxs("main",{children:[t.jsxs(o,{children:[t.jsx(z,{}),t.jsx(F,{})]}),t.jsx(D,{}),t.jsx(R,{})]}),t.jsx(H,{})]})})]})}export{_ as default};
